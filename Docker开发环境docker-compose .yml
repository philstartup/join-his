


version: '3.7'
# 网络配置
networks:
  backend:

# 服务容器配置
services:
  hyperf:
    image: "hyperf/hyperf:8.1-alpine-v3.16-swoole"
    volumes:
      - ./:/app
    ports:                               # 设置端口映射 暂时支持最多3个服务运行 不够自己再加
      - "9501:9501"
    networks:
      - backend
    privileged: true
    stdin_open: true                     # 打开标准输入，可以接受外部输入
    tty: true
    depends_on:
      - mysql
      - redis
    restart: always

  mysql:
    image: "mysql/mysql-server:5.7"
    environment:
      TZ: "Asia/Shanghai"
      MYSQL_ALLOW_EMPTY_PASSWORD: "true"
      MYSQL_ROOT_HOST: "%"
      MYSQL_DATABASE: "hyperf"
    privileged: true
    ports:
      - "3306:3306"
    volumes:
      - ./data/mysql:/var/lib/mysql        # 引用 .env 配置中 DATA_PATH_HOST 变量，将宿主机上存放 Mysql 数据的目录挂载到容器中 /var/lib/mysql 目录
      - ./config/init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - backend
    restart: always
    healthcheck:
      test: [ "CMD", "mysqladmin" ,"ping", "-h", "localhost" ]
      interval: 5s
      timeout: 10s
      retries: 10

  redis:
    image: redis
    environment:
      - TZ="Asia/Shanghai"
    privileged: true
    volumes:
      - ./data/redis:/data                 # 引用 .env 配置中 DATA_PATH_HOST 变量，将宿主机上存放 Redis 数据的目录挂载到容器中 /data 目录
    networks:
      - backend
    restart: always
